<!--<?php print <<<EOT
-->
<style type="text/css">
.wy_menu_B{border:1px solid #aaa;background:#ffffff url(c_editor/wy_menu_bg.png) repeat-x; position:absolute;padding:5px 0;border-left:1px solid #ccc;border-top:1px solid #ccc;}
.wy_menu_B a{color:#333;}
.wy_menu_B a:hover{ text-decoration:none;color:#3366cc;}
.wy_menu_B h4{display:block; font-size:14px; font-weight:700;color:#3366cc;padding:5px 10px;margin:0}
.wy_menu_B .tr1{padding-left:70px;text-align:center;}
.wy_menu_B .tr3{padding:4px 0 4px 10px;text-align:right;}
.wy_menu_B td{padding:4px 0 4px 10px;text-align:right;}
.wy_menu_B a.fr{color:#3366cc;}
#qanswer_info img{margin:0 0 0 5px;height:21px;}
</style>

<div id="breadCrumb">
		<img src="$imgpath/$stylepath/thread/home-old.gif" align="absmiddle" />&nbsp;<a href="$db_bfn" title="$db_bbsname">$db_bbsname</a><em>&gt;</em>新浪微薄帐号登录<em>&gt;</em>注册绑定
</div>

<!--
EOT;
if(!$step){print <<<EOT
-->

<div id="pw_content">
	<div class="p20">
		<div class="regTitle cc">
			<span class="fr">已经拥有帐号？<a href="login.php?action=weibologinbind" class="s4">立即绑定</a></span>
			<h5>欢迎{$weiboUser[name]}，如果你没有{$db_bbsname}账号，完善信息后即可访问</h5>
		</div>
		<table width="100%"><tr><td class="vt" height="300" style="padding-bottom:30px;">
		<form action="login.php?action=weibologinregister" method="post" name="register" onSubmit="return checkAll();">
		<input type="hidden" value="doreg" name="step" />
		<input type="hidden" value="cn0zz" name="_hexie" />
<!--
EOT;
$tmpVerify = GetVerify($onlineip);print <<<EOT
-->
<script type="text/javascript">
document.register._hexie.value='$tmpVerify';
</script>
		<div class="regForm">

			
			<!-- 输入框，悬停样式 hover 正确 current-->
			<dl>
				<dt><label for="regname">用户名<span class="s1">*</span></label></dt>
				<dd class="ip"><div class=""><input type="text" name="regname" id="regname" value="{$weiboUser[name]}" maxlength="$regmaxname" /></div></dd>
				<dd class="tp"><div id="regname_info"></div></dd>
			</dl>
			<dl class="cc">
				<dt><label for="regemail">电子邮箱<span class="s1">*</span></label></dt>
				<dd class="ip"><div class=""><input type="text"  maxlength="75" name="regemail" value="" id="regemail"/></div>
				</dd>
				<dd class="tp"><div id="email_info">
<!--
EOT;
if($rg_config['rg_emailtype'] == '1' && $rg_config['rg_email']){print <<<EOT
-->
					<div style="padding:0;position:relative;margin:-5px 0 0 -22px;width:390px;">为避免无法收取站点邮件，请使用以下电子邮箱进行注册:<br /><span class="s2">({$rg_config[rg_email]})</span></div>
<!--
EOT;
} elseif($rg_config['rg_emailtype'] == '2' && $rg_config['rg_banemail']){print <<<EOT
-->
					<div style="padding:0;position:relative;margin:-5px 0 0 -22px;width:390px;">为避免无法收取站点邮件，以下电子邮箱无法进行注册:<br /><span class="s2">({$rg_config[rg_banemail]})</span></div>
<!--
EOT;
}print<<<EOT
--></div>
				</dd>
			</dl>
<!--
EOT;
if($rg_config['rg_allowregister']==2){print <<<EOT
-->
			<dl>
				<dt><label for="invcode">邀请注册码<span class="s1">*</span></label></dt>
				<dd class="ip"><div><input type="text" value="$invcode" name="invcode" id="invcode" /></div></dd>
				<dd class="tp"><div id="invcode_info"></div>
				<span>
<!--
EOT;
if($inv_config['inv_onlinesell']){print <<<EOT
--><span id="buy_invitecode"><p class="p5"><a href="javascript:;" class="s4" onclick="insertOnlineSell();">购买邀请码</a></p></span>
<!--
EOT;
}print <<<EOT
--></span>
				</dd>
			</dl>
<!--
EOT;
}if($regq && $db_question){
$qkey = array_rand($db_question);
$db_question[$qkey] = addcslashes($db_question[$qkey],'"');
print <<<EOT
-->
			<dl>
				<dt><label for="regpwdrepeat">防恶意注册<span class="s1">*</span></label></dt>
				<dd class="ip"><div><input type="text" name="qanswer" id="qanswer" /><input type="hidden" id="regqkey" name="qkey" value="$qkey" /></div></dd>
				<dd class="tp"><div id="qanswer_info"></div></dd>
<!--
EOT;
if($showq){print <<<EOT
-->
				<dd class="regTips"><span id="qanswer_info">正确答案:$db_answer[$qkey]</span></dd>
<!--
EOT;
}print <<<EOT
-->								

			</dl>
<!--
EOT;
}if($rg_config['rg_ifcheck']){print <<<EOT
-->
			<dl class="cc">
				<dt>注册原因<span color="s1">*</span></dt>
				<dd class="ip">
					<textarea name="regreason" rows="4" cols="50" class="textareaA"></textarea>
				</dd>
				<dd class="tp"></dd>
			</dl>
<!--
EOT;
}if($customfield){
$fields = array();
print <<<EOT
-->
				<!--dl>
					<dt><span class="bb b s4">附加信息</span></dt>
					<dd>&nbsp;</dd>
					<dd class="tp">&nbsp;</dd>
				</dl-->
<!--
EOT;
foreach($customfield as $key=>$val){
$ids = '';
$field="field_".(int)$val[id];
$fieldinfo = $field."_info";
$required=$val[required]?'<span class="s1">*</span>':'';
$editable=(!$userdb[$field]||$val[editable])?'':'disabled';
!$val[editable] && $val[descrip] .='(请认真填写该栏信息，填写后将不允许修改)';
if($val[type]=='1'){
	if($val[required]){
		$fields[] = array('field'=>$field,'type'=>'text','descrip'=>$val[descrip]);
		$ids = "id=\"$field\"";
	}
	$field_type="<div><input type=\"text\" name=\"$field\" $ids /></div>";
}elseif($val[type]=='2'){
	if($val[required]){
		$fields[] = array('field'=>$field,'type'=>'textarea','descrip'=>$val[descrip]);
		$ids = "id=\"$field\"";
	}
	$field_type="<textarea name=\"$field\" $ids style=\"width:222px;margin-bottom:10px;\" class=\"textareaA\"></textarea>";
}elseif($val[type]=='3'){
	$field_type="<select name=\"$field\" id=\"$field\">";
	$options=explode("\n",$val[options]);
	foreach($options as $k=>$v){
		list($k,$v)=explode('=',$v);
		$field_type.="<option value=\"$k\">$v</option>";
	}
	$field_type.="</select>";
}
print <<<EOT
-->
			<dl class="cc">
				<dt>$val[title]{$required}</dt>
				<dd class="ip">{$field_type}</dd>
				<dd class="tp"><div id="$fieldinfo" class="ignore">$val[descrip]</div></dd>
			</dl>
<!--
EOT;
}}print <<<EOT
-->
<!--
EOT;
if($custominfo){
foreach($custominfo as $key=>$val){
if(substr($val[3],0,1)=='1'){print <<<EOT
-->
				<dl>
					<dt>$val[0]</dt>
					<dd class="ip"><div><input type="text" name="customdata[$key]" value="" /></div></dd>
					<dd class="tp"><div class="ignore">$val[1]</div></dd>
				</dl>
<!--
EOT;
}}}if($db_gdcheck & 1){
$gdSize = explode("\t",$db_gdsize);
print <<<EOT
-->

				<dl class="cc mb10">
						<dt><label for="gdcode">认证码<span class="s1">*</span></label></dt>
						<dd class="ip ck">
							<div><input id="gdcode" name="gdcode" value="" /></div>
							<span id="menu_gd"></span>
<script type="text/javascript" src="js/pw_authcode.js"></script>
<script>
var flashWidth = "$gdSize[0]";
var flashHeight = "$gdSize[1]";
var gdtype = $db_gdtype;
showGdCode();
</script>
						</dd>
						<dd class="tp"><div id="gdcode_info"></div></dd>
				</dl>
<!--
EOT;
}print <<<EOT
-->
				<dl class="cc">
					<dt>头像：</dt>
					<dd class="mr10">
						<label><input type="checkbox" name="useweiboavatar" value="1" checked />使用新浪微博头像</label>
						<div class="cc" style="margin-top:5px">
						<img style="border:1px solid #DDDDDD;padding:2px;" width="50" height="50" src="{$weiboUser[avatar]}" />
						</div>
					</dd>
					<dd class="tp"></dd>
				</dl>
				<dl style="min-height:25px;" class="cc mt10">
					<dt>&nbsp;</dt>
					<dd class="mr10"><label><input type="checkbox" name="rgpermit" value="1" id="registerclause" />&nbsp;我已阅读并完全同意 <a onclick="permit();" style="cursor:pointer" class="b s4">条款内容</a></label></dd>
					<dd class="tp"><div id="registerclause_info"></div></dd>
				</dl>
				<dl>
					<dt>&nbsp;</dt>
					<dd>
						<span class="btn"><span><button type="submit">提交注册</button></span></span>
						<span class="bt"><span><button type="reset">重 置</button></span></span>
					</dd>
					<dd class="regTips">
					</dd>
				</dl>
		</div>
		</form>
		</td></tr></table>
	</div>
</div>
<script language="JavaScript">
var regAjaxCheckUrl = '$db_registerfile';
</script>
<script type="text/javascript" language="JavaScript" src="js/pw_register.js"></script>
<script type="text/javascript" language="JavaScript" src="js/passwordstrength.js"></script>
<script language="JavaScript">
var charset = '$db_charset';
var retminname	= parseInt('$regminname');
var regmaxname	= parseInt('$regmaxname');
var rglower		= parseInt('$rg_config[rg_rglower]');
var regminpwd 	= parseInt('$rg_regminpwd');
var regmaxpwd 	= parseInt('$rg_regmaxpwd');
var regnpdifferf= parseInt('$rg_config[rg_npdifferf]');
var regemail	= parseInt('$rg_config[rg_emailcheck]');
var regdetail	= parseInt('$rg_config[rg_regdetail]');

var inticlass 	= "ignore";
var rightclass	= "correct";
var falseclass	= "wrong";

var pwdcomplex	= '$rg_config[rg_pwdcomplex]';
var extracheck	= new Array();
var regInfo 	= new Array();

regInfo[0] 		= new Array(
						"",
						"用户名长度错误！",
						"此用户名包含不可接受字符或被管理员屏蔽,请选择其它用户名",
						"为了避免站点用户名混乱,用户名中禁止使用大写字母,请使用小写字母",
						"该用户名已经被注册，请选用其他用户名。" ,
						"用户名不能为空！",
						"不能有空格，可以是中文，长度控制在 "+retminname+"-"+regmaxname+" 字节以内 " + (rglower?"区分大小写":"不区分大小写"));
var regname 	= new Element("regname",regInfo[0],"regname_info");

regInfo[1] 		= new Array(
						" ",
						"密码设置错误。密码中必须包含小写字母。",
						"密码设置错误。密码中必须包含大写字母。",
						"密码设置错误。密码中必须包含数字。",
						"密码设置错误。密码中必须包含符号。",
						"密码设置错误。密码长度过小。",
						"密码设置错误。密码过长。",
						"密码设置错误。密码不允许和用户名相同。",
						"密码设置错误。密码不允以下字符:\\ & ' \" ! / * , < > % # ?。",
						"不允许注册帐号与密码相同。",
                        getPwdRule());
var regpwd 		= new Element("regpwd",regInfo[1],"pwd_info");

regInfo[2] 		= new Array(
						" ",
						"两次输入的密码不一致。请再输入一次您上面输入的密码。",
						"请再输入一遍您上面填写的密码");
var regpwdrepeat= new Element("regpwdrepeat",regInfo[2],"pwdrepeat_info");

regInfo[3] 		= new Array(
						" ",
						"您的填写有误。",
						"该电子邮箱已被注册，请更换别邮箱。",
						"请填写真实并且最常用的电子邮箱。"+(regemail?"我们需要通过电子邮箱对您进行认证。":""),
						"电子邮箱不是系统指定的邮箱地址，不能注册",
						"请输入正确的电子邮箱地址");
var regemail 	= new Element("regemail",regInfo[3],"email_info");

if(parseInt("$db_gdcheck")&1){
	regInfo[4] 	= new Array(
						" ",
						"验证码不正确。",
						"登录已超时,请刷新验证码。",
						"请输入验证码。"	);
	var gdcode 	= new Element("regemail",regInfo[4],"gdcode_info");
}
if(getObj('regqkey')){
	if($showq){
		regInfo[5] 	= new Array(
						" ",
						"验证答案错误。",
						"问题:$db_question[$qkey]<br />请输入答案:$db_answer[$qkey]"	);
	}
	else{
		regInfo[5] 	= new Array(
						" ",
						"验证答案错误。",
						"问题:$db_question[$qkey]<br />");
	}
	var qanswer = new Element("qanswer",regInfo[5],"qanswer_info");
}
if(parseInt("$rg_config[rg_allowregister]")==2){
	var buy_invitecode = IsElement('buy_invitecode') ? getObj('buy_invitecode').innerHTML : '';
	regInfo[6] 	= new Array(
						" ",
						"邀请码不能为空。",
						"邀请码错误。",
						"本站开启邀请注册,请填写邀请码!" + buy_invitecode);
	var invcode = new Element("invcode",regInfo[6],"invcode_info");
}

regInfo[7] 		= new Array(
						"已同意。",
						"请先确定已阅读并完全同意条款内容。");
var registerclause 	= new Element("registerclause",regInfo[7],"registerclause_info");

regInfo[8] 		= new Array(
						" ",
						"请输入自定义问题");
var customquested 	= new Element("customquested",regInfo[8],"customquested_info");

regInfo[9] 		= new Array(
						" ",
						"请输入答案");
var answered 	= new Element("answered",regInfo[9],"answered_info");


function permit() {
	//getObj("registerclause").disabled = 'disabled';//b445
	try {ajax.send('$db_registerfile?ajax=1&step=permit','',ajax.get);} catch(e){}
}
if (regdetail) {
	setTimeout('permit();',1000);
}
function getPwdRule(){
	var intiString 	= "";
	if(regminpwd){
		intiString 	+= "最小长度:"+regminpwd+" ";
	}
	if(regmaxpwd){
		intiString 	+= "最大长度:"+regmaxpwd+" ";
	}
	if(regnpdifferf){
		intiString	+= "密码不能与用户名相同。";
	}
	if(!pwdcomplex){
		return intiString;
	}
	var addString 	= "密码里必须包含以下字符类型:";
	var rule = pwdcomplex.split(',');
	for(var i=0;i<rule.length;i++){
		switch(Number(rule[i])){
			case 1:
				addString += "小写字母 ";
				break;
			case 2:
				addString += "大写字母 ";
				break;
			case 3:
				addString += "数字 ";
				break;
			case 4:
				addString += "符号 ";
				break;
			default:
				break;
		}
	}
	return intiString + addString;
}
<!--
EOT;
if(count($fields)){
print <<<EOT
-->
var keep = 20;
<!--
EOT;
foreach($fields as $field){
print <<<EOT
-->
<!--
EOT;
if($field[type]!='text'){
print <<<EOT
-->
getObj("$field[field]").onfocus 	= onFocus;
getObj("$field[field]").onblur 		= onBlur;
extracheck.push(getObj("$field[field]"));
<!--
EOT;
}print <<<EOT
-->
regInfo[keep] 	= new Array(
						" ",
						"本选项不能为空。",
						"$field[descrip]");
var $field[field] = new Element("$field[field]",regInfo[keep],"$field[field]"+"_info");
keep++;
<!--
EOT;
}}print <<<EOT
-->

function showcustomquest(qid){
	getObj("customquested").style.display = qid==-1 ? '' : 'none';
}
function insertOnlineSell() {
	
	var menu_editor = getObj("menu_editor");
	//menu_editor.innerHTML = '';
	read.open('menu_editor','','2');
}
</script>
<!--
EOT;
} elseif ($step == 'finish') {
print <<<EOT
-->
<div id="pw_content">
	<div class="p20">
		<div class="regTitle cc">
			<h5>注册</h5>
		</div>
		<form action="$db_registerfile?" method="post" name="register">
		<input type="hidden" name="verify" value="$verifyhash" />
		<input type="hidden" name="step" value="finish" />
		<input type="hidden" name="option" value="1" />
		<table width="100%"><tr><td class="vt" height="200" style="padding-left:200px;">
		<div class="f16 b mb10">恭喜你！亲爱的{$windid}，您已经注册成功，您的初始密码为：{$loginUserInfo[extra][randomPassword]}</div>
		<div class="mb20"><span class="mr20"><span class="btn"><span><button type="submit">现在去完善资料</button></span></span></span><a href="./$db_bfn" class="s4 mr20" target="_blank">先去逛逛</a><a href="profile.php?action=weibobind&t=resetpwd" class="s4">修改密码</a></div>
		</td></tr></table>
		</form>
	</div>
</div>
<!--
EOT;
}
print <<<EOT
-->
<div id="menu_editor" style="display:none;">
<div class="popout"><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="bgcorner1"></td><td class="pobg1"></td><td class="bgcorner2"></td></tr><tr><td class="pobg4"></td><td>
<div class="popoutContent">
	<div style="width:400px;">
		<div class="popTop" onmousedown="read.move(event);" style=" cursor:move;"><span class="adel cp" onclick="closep();">关闭</span>购买邀请码</div>
			<form action="$db_registerfile?" method="post">
			<input type="hidden" name="action" value="pay" />
			<input type="hidden" name="step" value="3" />
			<div class="p10"><div class="ignoreTip" style="border-left:0;border-right:0;">购买一个邀请码需要$inv_config[inv_price]元，有效期$inv_config[inv_days]天，请及时注册</div></div>
<!--
EOT;
if(!empty($_POST['step'])){print <<<EOT
-->
			<div class="p10" style="padding-top:0;"><div class="rightTip">提示：您输入的邮箱中 ($email) 已经有一个生成订单，您确定现在支付？<input type="hidden" name="submit" value="1" /></div></div>
<!--
EOT;
}print <<<EOT
-->
			<table width="100%" class="vt">
				<tr>
					<td style="padding-left:20px;">购买的个数</td>
					<td><input class="input input_wa" type="text" name="invnum" value="$num" /></td>
				</tr>
				<tr>
					<td style="padding-left:20px;">接收邀请码的邮箱</td>
					<td><input class="input input_wa mb5" type="text" name="email" value="$email" /><p>我们会将邀请码发送到这个邮箱</p></td>
				</tr>
			</table>
			<div class="popBottom"><span class="btn2"><span><button type="submit">确认购买</button></span></span></div>
			</form>
	</div>
</div>
</td><td class="pobg2"></td></tr><tr><td class="bgcorner4"></td><td class="pobg3"></td><td class="bgcorner3"></td></tr></tbody></table></div>
</div>
<!--
EOT;
?>-->
